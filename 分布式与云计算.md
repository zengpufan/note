# 一、分布式系统概念与设计
## 1.1 分布式系统的特征
并发、缺乏全局时钟、故障独立性
## 1.5 分布式系统面临的挑战
0. 异构性、开放性、安全性、可伸缩性、故障处理、并发性、透明性、服务质量
1. 基础设施（例如网络、计算机硬件、操作系统、编程语言）存在异构性。
2. 中间件： 为了屏蔽底层设施的异构性，人们提出了中间件。中间件指一个软件层，提供一个抽象的编程。
3. 异构性和移动代码： 移动代码指计算机的代码能从一台计算机直接复制到另一台计算机上运行。虚拟机提供了一种移动代码的方法。

# 二、系统模型
物理模型、体系结构模型、基础模型。  
物理模型：考虑组成计算机的设备和硬件结构。  
体系结构：模型从系统的计算和通信任务来描述系统。
基础模型：采用抽象的观点描述单个问题的解决方案。例如：交互模型、故障模型、安全模型。

# 三、网络和网际互联
分布式系统的连接网络需要考虑的问题：
性能、可伸缩性、可靠性、安全性、移动性、服务质量、组播（一对多通信）

# 四、进程间通信
消息传递接口（Message Passing Interface， MPI）是一个标准，为一组具有同步和异步支持的消息传递操作提供API。
![](./分布式与云计算/中间件层.png)
## 同步通信和异步通信
消息传递通过java中的send和receive api进行操作。send是将数据复制到本地的一个消息队列中，receive是从远程的一个消息队列中读取一个信息。
通信分为同步通信和异步通信。在同步通信中，每次执行一个send操作之后，发送进程会一直阻塞，直到数据通过receive从消息队列中发送出去；在异步通信中，每次执行一个send操作之后，发送进程会继续执行别的操作，不会等待数据从消息队列中被读取。
同理，receive也有同步和异步之分。
简而言之，同步通信必须要对方接收了消息才能继续执行，而异步通信只需要放到消息队列里就可以了。

## 套接字
套接字是一个封装的api，可以自动地建立tcp、udp连接，并进行连接的维持。套接字的主要参数包括ip地址和端口号。
## TCP和UDP通信

## 4.3 外部数据表示和编码
不同的系统之间在数据传递的过程中，必须将数据进行编码。
编码的方式包括CORBA公共数据表示、java对象序列化、XML

## 远程对象调用
CORBA和java支持远程对象调用

## 组播通信
组播通信是将信息发送给一组接收者，不同于单播的发给单一接收者，广播的发给所有接收者。

# 五、远程调用
远程调用包括远程过程调用（RPC）和远程方法调用（RMI）。
这两个远程调用之间的区别就类似于面向对象和面向过程之间的区别。

## 5.2 请求应答协议
请求应答协议可以抽象成三个原语：doOperation getRequest sendReply
![](./分布式与云计算/请求应答协议.png)
请求应答协议基于上面提到的阻塞的send和receive（后面的间接通信会用到非阻塞的方法）  
- 消息标识符用来对每个消息进行编号，一种方法是使用一个requestId进行标识，另一种方法是使用ip地址+端口号进行标识。

- 请求应答协议的故障模型：通信故障有遗漏和未按照顺序传输。考虑到这些故障，doOperation在获取服务器应答时使用超时（time out）、丢弃重复的请求信息、使用幂等操作防止应答信息丢失产生重复请求。对于需要重新应答但是不需要重新操作的需要记录历史。
- 交互协议的类型：
请求R
请求应答RR
请求应答确认应答RRA

- 请求应答在TCP流中的使用

## 5.3远程过程调用RPC
- 接口编程：接口编程是RPC推动产生的编程风格。接口编程是指为每个模块定义一个显式的接口，模块之间通信只能访问接口提供的方法，隐藏了除接口之外的其他信息。只要接口保持相同，模块就可以随意改变。
- RPC调用的四种语义（书上只写了三种）
或许、至多一次、至少一次、精确一次

- RPC调用的实现
![](./分布式与云计算/RPC.png)
- - 客户端存根（Client Stub）
提供一个与远程方法接口相同的本地方法，调用时将请求序列化并发送到服务器。
- - 服务器存根（Server Stub）
接收来自客户端的请求，反序列化后调用实际的服务方法，并将结果序列化发送回客户端。
网络通信
- - 客户端与服务器之间通过网络传输序列化后的请求和响应数据。
序列化与反序列化
- - 将方法调用的参数和返回值在内存表示与传输格式（如 JSON、XML、Protobuf）之间转换。


## RMI






# 六、间接通信
间接通信可以实现时间解偶和空间解偶。空间解偶是指通信双方不知道对方是谁，时间解偶是指双方不需要同时存在。（注意异步通信和时间解偶有微弱的区别，异步通信是指发送信息之后不需要等待，时间解偶是指发送时甚至不需要存在）。
![](./分布式与云计算/间接通信.png)


# 七、操作系统支持
- 分布式操作系统：在一个分布式系统上，对多个硬件通过网络进行连接，操作系统提供一个虚拟的映像。
![](./分布式与云计算/distribute_OS.png)

# 八、分布式对象和组件
## 8.1
分布式对象中间件
## CORBA相关省略
## java bean

# 九、web服务
![](./分布式与云计算/web_service.png)
- URI（统一资源标识符）是用来唯一标识资源的字符串，是一个泛化概念；URL（统一资源定位符）是 URI 的子集，不仅标识资源，还提供访问资源的方式（如协议和地址）；URN（统一资源名称）也是 URI 的子集，仅用于标识资源的名称，而不涉及资源的定位或访问。简单来说，URL 关心“资源在哪里”，URN 关心“资源是什么”，而 URI 包含两者。
## 9.1 web服务
web服务中，信息的标识有soap和rest两种方式
![](./分布式与云计算/soap_vs_rest.png)

## 9.4 web服务使用的目录服务

## 9.5 XML安全性


# 十、对等系统
对等系统具有以下特点：每个用户都能向系统提供资源、每个成员有相同的功能和责任、不依赖中心管理系统、成员有一定的匿名性。

文件可以使用一个散列码来验证正确性，防止恶意篡改，但是这是在静态文件的前提下。

# 十一、安全性
## 1.简介
- 安全威胁分为三类：泄漏、篡改、蓄意破坏
- 窃听、伪装、消息篡改
- 重发、拒绝服务

# 十二、分布式文件系统

# 十三、名字服务
本章包含全局名字服务(GNS)和X.500目录服务
- 名字一般被绑定到对象的属性上，而不是对象的实现上。

# 十四、时间和全局状态
## 14.2 时钟、事件和进程状态
- 时钟偏移（clock skew）是指两个时钟在某个时刻读数的差异。
- 时钟漂移（clock shift）是指两个时钟射频不同，经过一段时间之后读数不同。
- 通用协调时间（UTC）时间基准，是通过原子钟得到的准确时间。
## 14.3 同步物理时钟
- 同步系统中的简单同步：
对于一个分布式系统，传输时间最大为max，最小为min，那么时钟偏移的最大值为u=max-min
同步时钟时，补偿的时间设置为u/2
对于N个时钟的系统，时钟偏移的最优范围是u(1-1/N)
- 客户端发送请求到时间服务器，记录发送时间T1。时间服务器收到请求后，返回当前时间Ts。客户端接收服务器时间，记录接收时间T2。
计算时间偏移为：
Offset=Ts+(T2-T1)/2
这种方法对基准时钟的依赖较高

- Berkeley算法
这种算法适用于没有可靠时间源的系统。
一个节点（主节点）收集所有节点的时间，包括自身。
主节点计算时间的平均值，并将时间调整值分发给所有节点。
各节点根据调整值更新自己的时钟。

## 14.4逻辑时钟
- 逻辑时钟只关注事件之间的因果关系，而不关注具体的物理时间。
每个节点维护一个逻辑时钟，初始值为 0。
当节点发生事件时，逻辑时钟加 1。
当节点发送消息时，将自己的逻辑时钟值附加到消息中。
当节点接收到消息时：
更新本地逻辑时钟为：
T_local=max(T_local,T_remote)+1
上述方法称为Lamtorp方法
- 每个事件的时间戳由两个部分组成：(L,ID)
如果L1 < L2，则事件 1 发生在事件 2 之前。
如果L1=L2，则通过比较节点 ID（字典序）来决定顺序。

# 十五、协调与协定
## 分布式互斥

# 十六、事务与并发控制

# 十七、分布式事务

# 十八、复制

# 十九、移动和无处不在计算

# 二十、分布式多媒体系统

# 二十一、Google分布式系统设计